<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800">

  <div class="max-w-7xl mx-auto p-6">
    <!-- 主要內容卡片 -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden mb-8">
      <!-- 圖片區域 -->
      <div class="relative">
        <p-image [src]="'https://api.funplanet.tw/upload/' + image()" alt="Event Image" width="100%" styleClass="object-cover lg:!h-96" [preview]="true" />
        <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
      </div>

      <!-- 內容區域 -->
      <div class="p-8">
        <!-- 標題區域 -->
        <div class="mb-8">
          <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-2">{{ name() }}</h1>
          <div class="flex items-center gap-3">
            <p-tag [value]="publish() === 1 ? 'Published' : 'Hidden'" [severity]="publish() === 1 ? 'success' : 'danger'" icon="pi pi-eye" />
          </div>
        </div>

        <!-- 詳細資訊網格 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
          <!-- 描述 -->
          <div class="md:col-span-2 lg:col-span-3">
            <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-6">
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                <i class="pi pi-file-edit mr-2 text-blue-500"></i>
                Description
              </h3>
              <div class="text-gray-700 dark:text-gray-300 leading-relaxed whitespace-pre-wrap" [innerHTML]="text()"></div>
            </div>
          </div>

          <!-- 容量資訊 -->
          <div class="bg-blue-50 dark:bg-blue-900/30 rounded-xl p-6">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
              <i class="pi pi-users mr-2 text-blue-500"></i>
              Capacity
            </h3>
            <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">{{min()}} ~ {{max()}}</div>
            <p class="text-sm text-gray-600 dark:text-gray-400">participants</p>
          </div>

          <!-- 候補容量 -->
          <div class="bg-amber-50 dark:bg-amber-900/30 rounded-xl p-6">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
              <i class="pi pi-clock mr-2 text-amber-500"></i>
              Waitlist
            </h3>
            <div class="text-2xl font-bold text-amber-600 dark:text-amber-400">{{max_standby()}}</div>
            <p class="text-sm text-gray-600 dark:text-gray-400">participants</p>
          </div>

          <!-- 發布狀態 -->
          <div class="bg-green-50 dark:bg-green-900/30 rounded-xl p-6">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
              <i class="pi pi-eye mr-2 text-green-500"></i>
              Status
            </h3>
            <div class="text-2xl font-bold" [class.text-green-600]="publish() === 1" [class.dark:text-green-400]="publish() === 1" [class.text-red-600]="publish() !== 1" [class.dark:text-red-400]="publish() !== 1">
              {{publish() === 1 ? 'Published' : 'Hidden'}}
            </div>
          </div>
        </div>
      </div>
    </div>




    <!-- Live List 區域 -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden mb-8">




      <p-accordion >
        <p-accordion-panel value="1">
          <p-accordion-header styleClass="!bg-gradient-to-r !from-purple-600 !to-purple-700 !text-white !border-0 !rounded-t-2xl">
            <div class="flex items-center justify-between w-full px-2">
              <div class="flex items-center">
                <i class="pi pi-list mr-3 text-xl"></i>
                <span class="text-2xl font-bold">Live Registration List</span>
              </div>
              <div class="flex items-center gap-2">
                <p-chip label="Accepted" styleClass="!bg-emerald-500 !text-white !text-xs !font-medium" />
                <p-chip label="Standby" styleClass="!bg-sky-500 !text-white !text-xs !font-medium" />
              </div>
            </div>
          </p-accordion-header>
          <p-accordion-content styleClass="!p-6">
            <div class="overflow-hidden rounded-lg border border-gray-200 dark:border-gray-600">
              <p-table [value]="timeList()" [rowHover]="true" styleClass="modern-table">
                <ng-template #header>
                  <tr class="bg-gray-50 dark:bg-gray-700">
                    <th class="!font-semibold !text-gray-900 dark:!text-white">Time Slot</th>
                    <th class="!font-semibold !text-gray-900 dark:!text-white">Session Name</th>
                    <th class="!font-semibold !text-gray-900 dark:!text-white">Participants</th>
                  </tr>
                </ng-template>
                <ng-template #body let-time let-rowIndex="rowIndex">
                  <tr [class.bg-gray-50]="rowIndex % 2 === 1" [class.dark:bg-gray-800]="rowIndex % 2 === 1">
                    <td class="!font-medium">
                      <div class="flex items-center">
                        <i class="pi pi-calendar mr-2 text-purple-500"></i>
                        {{ time.datetime }}
                      </div>
                    </td>
                    <td class="!text-gray-700 dark:!text-gray-300">{{ time.text }}</td>
                    <td>
                      <div class="flex flex-wrap gap-2">
                        @for (child of time.childList?.slice(0, max()); track $index) {
                          <p-chip [label]="child.child_name" styleClass="!bg-emerald-100 !text-emerald-800 dark:!bg-emerald-800 dark:!text-emerald-200 !text-xs !font-medium" />
                        }
                        @for (child of time.childList?.slice(max(), time.childList?.length); track $index) {
                          <p-chip [label]="child.child_name" styleClass="!bg-sky-100 !text-sky-800 dark:!bg-sky-800 dark:!text-sky-200 !text-xs !font-medium" />
                        }
                      </div>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </p-accordion-content>
        </p-accordion-panel>
      </p-accordion>
    </div>

    <!-- 訂單資料庫區域 -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden">
      <!-- 標題列 -->
      <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-6">
        <div class="flex justify-between items-center">
          <div class="flex items-center">
            <i class="pi pi-database mr-3 text-2xl"></i>
            <h2 class="text-3xl font-bold">Order Database</h2>
          </div>
          <p-button icon="pi pi-download" label="Export" severity="secondary" [outlined]="true" styleClass="!text-white !border-white hover:!bg-white hover:!text-indigo-600" />
        </div>
      </div>

      <div class="p-6">
        @for (time of timeList(); track $index; let i = $index) {
          <div class="mb-12 last:mb-0">
            <!-- 時間標題 -->
            <div class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white text-center py-4 rounded-t-lg mb-0">
              <div class="flex items-center justify-center">
                <i class="pi pi-clock mr-2"></i>
                <span class="text-xl font-semibold">{{ time.datetime }}</span>
              </div>
            </div>
            
            <!-- 批次操作區域 -->
            <div class="bg-gray-50 dark:bg-gray-700 border-x border-gray-200 dark:border-gray-600 p-4">
              <div class="flex items-center justify-between">
                <p-button label="Batch Delete (0)" icon="pi pi-trash" severity="danger" [outlined]="true" [disabled]="true" />
                <div class="text-sm text-gray-600 dark:text-gray-400">
                  Total: {{ (time.orderList || []).length }} orders
                </div>
              </div>
            </div>

            <!-- 訂單表格 -->
            <div class="border border-gray-200 dark:border-gray-600 rounded-b-lg overflow-hidden">
              <p-table [value]="time.orderList || []" [loading]="isLoading()" [rowHover]="true" styleClass="modern-table">
                <ng-template #header>
                  <tr class="bg-gray-100 dark:bg-gray-700">
                    <th style="width: 3rem" class="!text-center">
                      <p-checkbox />
                    </th>
                    <th class="!font-semibold">#</th>
                    <th class="!font-semibold" style="min-width: 108px;">Child Name</th>
                    <th class="!font-semibold" style="min-width: 109px;">Parent LINE</th>
                    <th class="!font-semibold">Phone</th>
                    <th class="!font-semibold">Payment Method</th>
                    <th class="!font-semibold !text-center">Actions</th>
                    <th class="!font-semibold">Registration Time</th>
                    <th class="!font-semibold" style="width: 200px">Notes</th>
                  </tr>
                </ng-template>
                <ng-template #body let-order let-rowIndex="rowIndex">
                  <tr class="hover:!bg-gray-50 dark:hover:!bg-gray-700 transition-colors">
                    <td class="!text-center">
                      <p-checkbox />
                    </td>
                    <td class="!font-medium !text-gray-900 dark:!text-white">{{ rowIndex + 1 }}</td>
                    <td class="!font-medium">
                      <div class="flex items-center">
                        <i class="pi pi-user mr-2 text-blue-500"></i>
                        {{ order.childName }}
                      </div>
                    </td>
                    <td class="!text-gray-700 dark:!text-gray-300">{{ order.parentLine }}</td>
                    <td class="!text-gray-700 dark:!text-gray-300">{{ order.phone }}</td>
                    <td>
                      <p-tag [value]="order.onlinePayment || 'N/A'" severity="info" styleClass="!text-xs" />
                    </td>
                    <td class="!text-center">
                      <p-button icon="pi pi-trash" severity="danger" [text]="true" size="small" styleClass="!text-red-500 hover:!text-red-700 hover:!bg-red-50" pTooltip="Delete Order" tooltipPosition="top" />
                    </td>
                    <td class="!text-sm !text-gray-600 dark:!text-gray-400">{{ order.createdAt }}</td>
                    <td>
                      <div class="flex items-center gap-2">
                        <i class="pi pi-pencil text-blue-500 cursor-pointer hover:text-blue-700 transition-colors" pTooltip="Edit Note" tooltipPosition="top"></i>
                        <span class="text-sm text-gray-700 dark:text-gray-300 truncate">{{ order.note || 'No notes' }}</span>
                      </div>
                    </td>
                  </tr>
                </ng-template>
                <ng-template #empty>
                  <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                    <i class="pi pi-inbox text-4xl mb-4 block"></i>
                    <p class="text-lg">No orders for this time slot</p>
                  </div>
                </ng-template>
              </p-table>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
</div>

<p-blockui [blocked]="isLoading()" fullScreen="true" styleClass="!bg-black/20 !backdrop-blur-sm">
  <div class="flex  items-center w-full min-h-full">
    <p-progressSpinner styleClass="!w-12 !h-12"  strokeWidth="6" styleClass="w-12 h-12"/>
  </div>
</p-blockui>