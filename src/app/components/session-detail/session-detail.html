<div class="p-4">
  <p-image [src]="'https://api.funplanet.tw/upload/' + image()" alt="Image" />
  <div class="text-xl">Name: </div>
  <div>{{ name() }}</div>
  <div class="text-xl">Description: </div>
  <div class="Description" [innerHTML]="text()"></div>
  <div class="text-xl"># of People: </div>
  <div>{{min()}} ~ {{max()}} </div>
  <div class="text-xl">Standby people: </div>
  <div>{{max_standby()}} </div>
  <div class="text-xl">Show/Hide: </div>
  <div>{{publish()===1 ? 'Show' : 'Hide'}} </div>

  <p-accordion value="0">
    <p-accordion-panel value="0">
      <p-accordion-header class="flex">
        <span class="!text-3xl">Live List</span>
        <span class="ml-auto"><p-chip label="Accepted" class="mr-1 !bg-emerald-500 !text-white" /><p-chip label="Standby" class="mr-2 !bg-sky-500 !text-white" /></span>
        
      </p-accordion-header>
      <p-accordion-content>
        <p-table [value]="timeList()">
          <ng-template #header>
            <tr>
              <th>Time</th>
              <th>Name</th>
              <th>Baby List</th>
            </tr>
          </ng-template>
          <ng-template #body let-time>
            <tr>
              <td>{{ time.datetime }}</td>
              <td>{{ time.text }}</td>
              <td>
                <!-- 正取名單 (0 到 max) -->
                @for (child of time.childList?.slice(0, max()); track $index) {
                  <p-chip 
                    [label]="child.child_name" 
                    class="mr-1 mb-1 !bg-emerald-500 !text-white" />
                }
                <!-- 候補名單 (max 到 結束) -->
                @for (child of time.childList?.slice(max(), time.childList?.length); track $index) {
                  <p-chip 
                    [label]="child.child_name" 
                    class="mr-1 !bg-sky-500 !text-white" />
                }

              </td>
            </tr>
          </ng-template>
        </p-table>
      </p-accordion-content>
    </p-accordion-panel>
  </p-accordion>

  <!-- 訂單資料庫 -->
  <div class="flex mt-16 mb-4 justify-between items-center">
    <div class="text-4xl font-black flex items-center">
      訂單資料庫
      <i class="pi pi-database ml-2"></i>
    </div>
    <p-button  icon="pi pi-download"  severity="info"  [outlined]="true"  />
  </div>

  @for (time of timeList(); track $index; let i = $index) {
    <div class="mb-16">
      <!-- 時間標題 -->
      <div class="text-xl bg-purple-700 text-white text-center py-2 rounded-t">
        {{ time.datetime }}
      </div>
      
      <!-- 批次操作按鈕 -->
      <div class="flex mb-2 p-4 bg-gray-50 rounded-b">
        <p-button 
          label="批次刪除 (0)"
          severity="danger" 
          [outlined]="true"
          [disabled]="true"
          class="mr-2" />
      </div>

      <!-- 訂單表格 -->
      <div class="shadow-lg rounded overflow-hidden">
        <p-table 
          [value]="time.orderList || []" 
          [loading]="isLoading()"
          [rowHover]="true">
          <ng-template #header>
            <tr>
              <th style="width: 3rem">
              </th>
              <th>#</th>
              <th>小朋友稱呼</th>
              <th>家長LINE稱呼</th>
              <th>家長手機</th>
              <th>(線上場)付款方式</th>
              <th>動作</th>
              <th>報名時間</th>
              <th style="width: 170px">備註</th>
            </tr>
          </ng-template>
          <ng-template #body let-order let-rowIndex="rowIndex">
            <tr>
              <td>
              </td>
              <td>{{ rowIndex + 1 }}</td>
              <td>{{ order.childName }}</td>
              <td>{{ order.parentLine }}</td>
              <td>{{ order.phone }}</td>
              <td>{{ order.onlinePayment }}</td>
              <td>
                <p-button 
                  icon="pi pi-trash" 
                  severity="danger" 
                  [text]="true"
                   />
              </td>
              <td>{{ order.createdAt }}</td>
              <td>
                <div class="flex items-center">
                  <i class="pi pi-pencil text-blue-500 cursor-pointer mr-2" 
                     ></i>
                  <span>{{ order.note }}</span>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  }

</div>


<p-blockui [blocked]="isLoading()" fullScreen="true">
  <p-progressSpinner />
</p-blockui>